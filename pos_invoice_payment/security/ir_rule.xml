<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Record rule: POS users can only read posted customer invoices -->
    <record id="pos_invoice_payment_rule_account_move" model="ir.rule">
        <field name="name">POS User: Read Posted Customer Invoices Only</field>
        <field name="model_id" ref="account.model_account_move"/>
        <field name="domain_force">[
            ('move_type', '=', 'out_invoice'),
            ('state', '=', 'posted')
        ]</field>
        <field name="groups" eval="[(4, ref('point_of_sale.group_pos_user'))]"/>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="False"/>
        <field name="perm_create" eval="False"/>
        <field name="perm_unlink" eval="False"/>
    </record>

    <!-- Record rule: POS users can only read invoice lines from posted invoices -->
    <record id="pos_invoice_payment_rule_account_move_line" model="ir.rule">
        <field name="name">POS User: Read Posted Invoice Lines Only</field>
        <field name="model_id" ref="account.model_account_move_line"/>
        <field name="domain_force">[
            ('move_id.move_type', '=', 'out_invoice'),
            ('move_id.state', '=', 'posted')
        ]</field>
        <field name="groups" eval="[(4, ref('point_of_sale.group_pos_user'))]"/>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="False"/>
        <field name="perm_create" eval="False"/>
        <field name="perm_unlink" eval="False"/>
    </record>

    <!-- Record rule: POS users can create and read customer payments -->
    <record id="pos_invoice_payment_rule_account_payment" model="ir.rule">
        <field name="name">POS User: Create and Read Customer Payments</field>
        <field name="model_id" ref="account.model_account_payment"/>
        <field name="domain_force">[
            ('payment_type', '=', 'inbound'),
            ('partner_type', '=', 'customer')
        ]</field>
        <field name="groups" eval="[(4, ref('point_of_sale.group_pos_user'))]"/>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="False"/>
        <field name="perm_create" eval="True"/>
        <field name="perm_unlink" eval="False"/>
    </record>

    <!-- Record rule: Accounting users can create/read all payments (overrides POS restriction) -->
    <record id="pos_invoice_payment_rule_account_payment_accounting" model="ir.rule">
        <field name="name">Accounting: All Payments Access</field>
        <field name="model_id" ref="account.model_account_payment"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[
            (4, ref('account.group_account_manager')),
            (4, ref('account.group_account_user')),
            (4, ref('account.group_account_invoice'))
        ]"/>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="False"/>
        <field name="perm_create" eval="True"/>
        <field name="perm_unlink" eval="False"/>
    </record>
</odoo>
